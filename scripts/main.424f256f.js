console.log("'Allo 'Allo!"),$(function(){PARTICLES.init()}),THREE.CSS3DObject=function(a){THREE.Object3D.call(this),this.element=a,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(a){THREE.CSS3DObject.call(this,a)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(){console.log("THREE.CSS3DRenderer",THREE.REVISION);var a,b,c,d,e=new THREE.Matrix4,f={camera:{fov:0,style:""},objects:{}},g=document.createElement("div");g.style.overflow="hidden",g.style.WebkitTransformStyle="preserve-3d",g.style.MozTransformStyle="preserve-3d",g.style.oTransformStyle="preserve-3d",g.style.transformStyle="preserve-3d",this.domElement=g;var h=document.createElement("div");h.style.WebkitTransformStyle="preserve-3d",h.style.MozTransformStyle="preserve-3d",h.style.oTransformStyle="preserve-3d",h.style.transformStyle="preserve-3d",g.appendChild(h),this.setClearColor=function(){},this.getSize=function(){return{width:a,height:b}},this.setSize=function(e,f){a=e,b=f,c=a/2,d=b/2,g.style.width=e+"px",g.style.height=f+"px",h.style.width=e+"px",h.style.height=f+"px"};var i=function(a){return Math.abs(a)<Number.EPSILON?0:a},j=function(a){var b=a.elements;return"matrix3d("+i(b[0])+","+i(-b[1])+","+i(b[2])+","+i(b[3])+","+i(b[4])+","+i(-b[5])+","+i(b[6])+","+i(b[7])+","+i(b[8])+","+i(-b[9])+","+i(b[10])+","+i(b[11])+","+i(b[12])+","+i(-b[13])+","+i(b[14])+","+i(b[15])+")"},k=function(a){var b=a.elements;return"translate3d(-50%,-50%,0) matrix3d("+i(b[0])+","+i(b[1])+","+i(b[2])+","+i(b[3])+","+i(-b[4])+","+i(-b[5])+","+i(-b[6])+","+i(-b[7])+","+i(b[8])+","+i(b[9])+","+i(b[10])+","+i(b[11])+","+i(b[12])+","+i(b[13])+","+i(b[14])+","+i(b[15])+")"},l=function(a,b){if(a instanceof THREE.CSS3DObject){var c;a instanceof THREE.CSS3DSprite?(e.copy(b.matrixWorldInverse),e.transpose(),e.copyPosition(a.matrixWorld),e.scale(a.scale),e.elements[3]=0,e.elements[7]=0,e.elements[11]=0,e.elements[15]=1,c=k(e)):c=k(a.matrixWorld);var d=a.element,g=f.objects[a.id];(void 0===g||g!==c)&&(d.style.WebkitTransform=c,d.style.MozTransform=c,d.style.oTransform=c,d.style.transform=c,f.objects[a.id]=c),d.parentNode!==h&&h.appendChild(d)}for(var i=0,j=a.children.length;j>i;i++)l(a.children[i],b)};this.render=function(a,e){var i=.5/Math.tan(THREE.Math.degToRad(.5*e.fov))*b;f.camera.fov!==i&&(g.style.WebkitPerspective=i+"px",g.style.MozPerspective=i+"px",g.style.oPerspective=i+"px",g.style.perspective=i+"px",f.camera.fov=i),a.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld);var k="translate3d(0,0,"+i+"px)"+j(e.matrixWorldInverse)+" translate3d("+c+"px,"+d+"px, 0)";f.camera.style!==k&&(h.style.WebkitTransform=k,h.style.MozTransform=k,h.style.oTransform=k,h.style.transform=k,f.camera.style=k),l(a,e)}},THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(a)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial;return a.copy(this),a.color.copy(this.color),a.program=this.program,a},THREE.CanvasRenderer=function(a){function b(){ra.setRGB(0,0,0),sa.setRGB(0,0,0),ta.setRGB(0,0,0);for(var a=0,b=w.length;b>a;a++){var c=w[a],d=c.color;c instanceof THREE.AmbientLight?ra.add(d):c instanceof THREE.DirectionalLight?sa.add(d):c instanceof THREE.PointLight&&ta.add(d)}}function c(a,b,c){for(var d=0,e=w.length;e>d;d++){var f=w[d];if(ma.copy(f.color),f instanceof THREE.DirectionalLight){var g=ua.setFromMatrixPosition(f.matrixWorld).normalize(),h=b.dot(g);if(0>=h)continue;h*=f.intensity,c.add(ma.multiplyScalar(h))}else if(f instanceof THREE.PointLight){var g=ua.setFromMatrixPosition(f.matrixWorld),h=b.dot(ua.subVectors(g,a).normalize());if(0>=h)continue;if(h*=0==f.distance?1:1-Math.min(a.distanceTo(g)/f.distance,1),0==h)continue;h*=f.intensity,c.add(ma.multiplyScalar(h))}}}function d(a,b,c){m(c.opacity),n(c.blending);var d=b.scale.x*T,e=b.scale.y*U,f=.5*Math.sqrt(d*d+e*e);if(qa.min.set(a.x-f,a.y-f),qa.max.set(a.x+f,a.y+f),c instanceof THREE.SpriteMaterial){var g=c.map;if(null!==g){var h=na[g.id];if((void 0===h||h.version!==g.version)&&(h=j(g),na[g.id]=h),void 0!==h.canvas){s(h.canvas);var i=g.image,k=i.width*g.offset.x,l=i.height*g.offset.y,o=i.width*g.repeat.x,p=i.height*g.repeat.y,q=d/o,t=e/p;$.save(),$.translate(a.x,a.y),0!==c.rotation&&$.rotate(c.rotation),$.translate(-d/2,-e/2),$.scale(q,t),$.translate(-k,-l),$.fillRect(k,l,o,p),$.restore()}}else s(c.color.getStyle()),$.save(),$.translate(a.x,a.y),0!==c.rotation&&$.rotate(c.rotation),$.scale(d,-e),$.fillRect(-.5,-.5,1,1),$.restore()}else c instanceof THREE.SpriteCanvasMaterial&&(r(c.color.getStyle()),s(c.color.getStyle()),$.save(),$.translate(a.x,a.y),0!==c.rotation&&$.rotate(c.rotation),$.scale(d,e),c.program($),$.restore())}function e(a,b,c,d){if(m(d.opacity),n(d.blending),$.beginPath(),$.moveTo(a.positionScreen.x,a.positionScreen.y),$.lineTo(b.positionScreen.x,b.positionScreen.y),d instanceof THREE.LineBasicMaterial){if(o(d.linewidth),p(d.linecap),q(d.linejoin),d.vertexColors!==THREE.VertexColors)r(d.color.getStyle());else{var e=c.vertexColors[0].getStyle(),f=c.vertexColors[1].getStyle();if(e===f)r(e);else{try{var g=$.createLinearGradient(a.positionScreen.x,a.positionScreen.y,b.positionScreen.x,b.positionScreen.y);g.addColorStop(0,e),g.addColorStop(1,f)}catch(h){g=e}r(g)}}$.stroke(),qa.expandByScalar(2*d.linewidth)}else d instanceof THREE.LineDashedMaterial&&(o(d.linewidth),p(d.linecap),q(d.linejoin),r(d.color.getStyle()),t([d.dashSize,d.gapSize]),$.stroke(),qa.expandByScalar(2*d.linewidth),t([]))}function f(a,b,d,e,f,j,l,o){if(O.info.render.vertices+=3,O.info.render.faces++,m(o.opacity),n(o.blending),B=a.positionScreen.x,C=a.positionScreen.y,D=b.positionScreen.x,E=b.positionScreen.y,F=d.positionScreen.x,G=d.positionScreen.y,g(B,C,D,E,F,G),(o instanceof THREE.MeshLambertMaterial||o instanceof THREE.MeshPhongMaterial)&&null===o.map)ka.copy(o.color),la.copy(o.emissive),o.vertexColors===THREE.FaceColors&&ka.multiply(l.color),ja.copy(ra),va.copy(a.positionWorld).add(b.positionWorld).add(d.positionWorld).divideScalar(3),c(va,l.normalModel,ja),ja.multiply(ka).add(la),o.wireframe===!0?h(ja,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):i(ja);else if(o instanceof THREE.MeshBasicMaterial||o instanceof THREE.MeshLambertMaterial||o instanceof THREE.MeshPhongMaterial)if(null!==o.map){var p=o.map.mapping;p===THREE.UVMapping&&(H=l.uvs,k(B,C,D,E,F,G,H[e].x,H[e].y,H[f].x,H[f].y,H[j].x,H[j].y,o.map))}else null!==o.envMap?o.envMap.mapping===THREE.SphericalReflectionMapping&&(wa.copy(l.vertexNormalsModel[e]).applyMatrix3(xa),I=.5*wa.x+.5,J=.5*wa.y+.5,wa.copy(l.vertexNormalsModel[f]).applyMatrix3(xa),K=.5*wa.x+.5,L=.5*wa.y+.5,wa.copy(l.vertexNormalsModel[j]).applyMatrix3(xa),M=.5*wa.x+.5,N=.5*wa.y+.5,k(B,C,D,E,F,G,I,J,K,L,M,N,o.envMap)):(ja.copy(o.color),o.vertexColors===THREE.FaceColors&&ja.multiply(l.color),o.wireframe===!0?h(ja,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):i(ja));else o instanceof THREE.MeshNormalMaterial?(wa.copy(l.normalModel).applyMatrix3(xa),ja.setRGB(wa.x,wa.y,wa.z).multiplyScalar(.5).addScalar(.5),o.wireframe===!0?h(ja,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):i(ja)):(ja.setRGB(1,1,1),o.wireframe===!0?h(ja,o.wireframeLinewidth,o.wireframeLinecap,o.wireframeLinejoin):i(ja))}function g(a,b,c,d,e,f){$.beginPath(),$.moveTo(a,b),$.lineTo(c,d),$.lineTo(e,f),$.closePath()}function h(a,b,c,d){o(b),p(c),q(d),r(a.getStyle()),$.stroke(),qa.expandByScalar(2*b)}function i(a){s(a.getStyle()),$.fill()}function j(a){if(0===a.version||a instanceof THREE.CompressedTexture||a instanceof THREE.DataTexture)return{canvas:void 0,version:a.version};var b=a.image,c=document.createElement("canvas");c.width=b.width,c.height=b.height;var d=c.getContext("2d");d.setTransform(1,0,0,-1,0,b.height),d.drawImage(b,0,0);var e=a.wrapS===THREE.RepeatWrapping,f=a.wrapT===THREE.RepeatWrapping,g="no-repeat";return e===!0&&f===!0?g="repeat":e===!0?g="repeat-x":f===!0&&(g="repeat-y"),{canvas:$.createPattern(c,g),version:a.version}}function k(a,b,c,d,e,f,g,h,i,k,l,m,n){var o=na[n.id];if((void 0===o||o.version!==n.version)&&(o=j(n),na[n.id]=o),void 0===o.canvas)return s("rgba( 0, 0, 0, 1)"),void $.fill();s(o.canvas);var p,q,r,t,u,v,w,x,y=n.offset.x/n.repeat.x,z=n.offset.y/n.repeat.y,A=n.image.width*n.repeat.x,B=n.image.height*n.repeat.y;g=(g+y)*A,h=(h+z)*B,i=(i+y)*A,k=(k+z)*B,l=(l+y)*A,m=(m+z)*B,c-=a,d-=b,e-=a,f-=b,i-=g,k-=h,l-=g,m-=h,w=i*m-l*k,0!==w&&(x=1/w,p=(m*c-k*e)*x,q=(m*d-k*f)*x,r=(i*e-l*c)*x,t=(i*f-l*d)*x,u=a-p*g-r*h,v=b-q*g-t*h,$.save(),$.transform(p,q,r,t,u,v),$.fill(),$.restore())}function l(a,b,c){var d,e=b.x-a.x,f=b.y-a.y,g=e*e+f*f;0!==g&&(d=c/Math.sqrt(g),e*=d,f*=d,b.x+=e,b.y+=f,a.x-=e,a.y-=f)}function m(a){ba!==a&&($.globalAlpha=a,ba=a)}function n(a){ca!==a&&(a===THREE.NormalBlending?$.globalCompositeOperation="source-over":a===THREE.AdditiveBlending?$.globalCompositeOperation="lighter":a===THREE.SubtractiveBlending&&($.globalCompositeOperation="darker"),ca=a)}function o(a){fa!==a&&($.lineWidth=a,fa=a)}function p(a){ga!==a&&($.lineCap=a,ga=a)}function q(a){ha!==a&&($.lineJoin=a,ha=a)}function r(a){da!==a&&($.strokeStyle=a,da=a)}function s(a){ea!==a&&($.fillStyle=a,ea=a)}function t(a){ia.length!==a.length&&($.setLineDash(a),ia=a)}console.log("THREE.CanvasRenderer",THREE.REVISION),a=a||{};var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=this,P=new THREE.Projector,Q=void 0!==a.canvas?a.canvas:document.createElement("canvas"),R=Q.width,S=Q.height,T=Math.floor(R/2),U=Math.floor(S/2),V=0,W=0,X=R,Y=S,Z=1,$=Q.getContext("2d",{alpha:a.alpha===!0}),_=new THREE.Color(0),aa=a.alpha===!0?0:1,ba=1,ca=0,da=null,ea=null,fa=null,ga=null,ha=null,ia=[],ja=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),ka=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),la=new THREE.Color,ma=new THREE.Color,na={},oa=new THREE.Box2,pa=new THREE.Box2,qa=new THREE.Box2,ra=new THREE.Color,sa=new THREE.Color,ta=new THREE.Color,ua=new THREE.Vector3,va=new THREE.Vector3,wa=new THREE.Vector3,xa=new THREE.Matrix3;void 0===$.setLineDash&&($.setLineDash=function(){}),this.domElement=Q,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.getPixelRatio=function(){return Z},this.setPixelRatio=function(a){void 0!==a&&(Z=a)},this.setSize=function(a,b,c){R=a*Z,S=b*Z,Q.width=R,Q.height=S,T=Math.floor(R/2),U=Math.floor(S/2),c!==!1&&(Q.style.width=a+"px",Q.style.height=b+"px"),oa.min.set(-T,-U),oa.max.set(T,U),pa.min.set(-T,-U),pa.max.set(T,U),ba=1,ca=0,da=null,ea=null,fa=null,ga=null,ha=null,this.setViewport(0,0,a,b)},this.setViewport=function(a,b,c,d){V=a*Z,W=b*Z,X=c*Z,Y=d*Z},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(a,b){_.set(a),aa=void 0!==b?b:1,pa.min.set(-T,-U),pa.max.set(T,U)},this.setClearColorHex=function(a,b){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(a,b)},this.getClearColor=function(){return _},this.getClearAlpha=function(){return aa},this.getMaxAnisotropy=function(){return 0},this.clear=function(){pa.empty()===!1&&(pa.intersect(oa),pa.expandByScalar(2),pa.min.x=pa.min.x+T,pa.min.y=-pa.min.y+U,pa.max.x=pa.max.x+T,pa.max.y=-pa.max.y+U,1>aa&&$.clearRect(0|pa.min.x,0|pa.max.y,pa.max.x-pa.min.x|0,pa.min.y-pa.max.y|0),aa>0&&(n(THREE.NormalBlending),m(1),s("rgba("+Math.floor(255*_.r)+","+Math.floor(255*_.g)+","+Math.floor(255*_.b)+","+aa+")"),$.fillRect(0|pa.min.x,0|pa.max.y,pa.max.x-pa.min.x|0,pa.min.y-pa.max.y|0)),pa.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(a,c){if(c instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");this.autoClear===!0&&this.clear(),O.info.render.vertices=0,O.info.render.faces=0,$.setTransform(X/R,0,0,-Y/S,V,S-W),$.translate(T,U),u=P.projectScene(a,c,this.sortObjects,this.sortElements),v=u.elements,w=u.lights,x=c,xa.getNormalMatrix(c.matrixWorldInverse),b();for(var g=0,h=v.length;h>g;g++){var i=v[g],j=i.material;if(void 0!==j&&0!==j.opacity){if(qa.makeEmpty(),i instanceof THREE.RenderableSprite)y=i,y.x*=T,y.y*=U,d(y,i,j);else if(i instanceof THREE.RenderableLine)y=i.v1,z=i.v2,y.positionScreen.x*=T,y.positionScreen.y*=U,z.positionScreen.x*=T,z.positionScreen.y*=U,qa.setFromPoints([y.positionScreen,z.positionScreen]),oa.isIntersectionBox(qa)===!0&&e(y,z,i,j);else if(i instanceof THREE.RenderableFace){if(y=i.v1,z=i.v2,A=i.v3,y.positionScreen.z<-1||y.positionScreen.z>1)continue;if(z.positionScreen.z<-1||z.positionScreen.z>1)continue;if(A.positionScreen.z<-1||A.positionScreen.z>1)continue;y.positionScreen.x*=T,y.positionScreen.y*=U,z.positionScreen.x*=T,z.positionScreen.y*=U,A.positionScreen.x*=T,A.positionScreen.y*=U,j.overdraw>0&&(l(y.positionScreen,z.positionScreen,j.overdraw),l(z.positionScreen,A.positionScreen,j.overdraw),l(A.positionScreen,y.positionScreen,j.overdraw)),qa.setFromPoints([y.positionScreen,z.positionScreen,A.positionScreen]),oa.isIntersectionBox(qa)===!0&&f(y,z,A,0,1,2,i,j)}pa.union(qa)}}$.setTransform(1,0,0,1,0,0)}},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld),this.positionScreen.copy(a.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){function a(){if(i===t){var a=new THREE.RenderableObject;return s.push(a),t++,i++,a}return s[i++]}function b(){if(k===v){var a=new THREE.RenderableVertex;return u.push(a),v++,k++,a}return u[k++]}function c(){if(m===x){var a=new THREE.RenderableFace;return w.push(a),x++,m++,a}return w[m++]}function d(){if(o===z){var a=new THREE.RenderableLine;return y.push(a),z++,o++,a}return y[o++]}function e(){if(q===B){var a=new THREE.RenderableSprite;return A.push(a),B++,q++,a}return A[q++]}function f(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function g(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;return e>=0&&f>=0&&g>=0&&h>=0?!0:0>e&&0>f||0>g&&0>h?!1:(0>e?c=Math.max(c,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f))),0>g?c=Math.max(c,g/(g-h)):0>h&&(d=Math.min(d,g/(g-h))),c>d?!1:(a.lerp(b,c),b.lerp(a,1-d),!0))}var h,i,j,k,l,m,n,o,p,q,r,s=[],t=0,u=[],v=0,w=[],x=0,y=[],z=0,A=[],B=0,C={objects:[],lights:[],elements:[]},D=new THREE.Vector3,E=new THREE.Vector4,F=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),G=new THREE.Box3,H=new Array(3),I=(new Array(4),new THREE.Matrix4),J=new THREE.Matrix4,K=new THREE.Matrix4,L=new THREE.Matrix3,M=new THREE.Frustum,N=new THREE.Vector4,O=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project()."),a.project(b)},this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),a.unproject(b)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var P=function(){var a=[],e=[],f=null,g=null,h=new THREE.Matrix3,i=function(b){f=b,g=f.material,h.getNormalMatrix(f.matrixWorld),a.length=0,e.length=0},k=function(a){var b=a.position,c=a.positionWorld,d=a.positionScreen;c.copy(b).applyMatrix4(r),d.copy(c).applyMatrix4(J);var e=1/d.w;d.x*=e,d.y*=e,d.z*=e,a.visible=d.x>=-1&&d.x<=1&&d.y>=-1&&d.y<=1&&d.z>=-1&&d.z<=1},m=function(a,c,d){j=b(),j.position.set(a,c,d),k(j)},o=function(b,c,d){a.push(b,c,d)},p=function(a,b){e.push(a,b)},q=function(a,b,c){return a.visible===!0||b.visible===!0||c.visible===!0?!0:(H[0]=a.positionScreen,H[1]=b.positionScreen,H[2]=c.positionScreen,F.isIntersectionBox(G.setFromPoints(H)))},s=function(a,b,c){return(c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)<0},t=function(a,b){var c=u[a],e=u[b];n=d(),n.id=f.id,n.v1.copy(c),n.v2.copy(e),n.z=(c.positionScreen.z+e.positionScreen.z)/2,n.renderOrder=f.renderOrder,n.material=f.material,C.elements.push(n)},v=function(b,d,i){var j=u[b],k=u[d],m=u[i];if(q(j,k,m)!==!1&&(g.side===THREE.DoubleSide||s(j,k,m)===!0)){l=c(),l.id=f.id,l.v1.copy(j),l.v2.copy(k),l.v3.copy(m),l.z=(j.positionScreen.z+k.positionScreen.z+m.positionScreen.z)/3,l.renderOrder=f.renderOrder,l.normalModel.fromArray(a,3*b),l.normalModel.applyMatrix3(h).normalize();for(var n=0;3>n;n++){var o=l.vertexNormalsModel[n];o.fromArray(a,3*arguments[n]),o.applyMatrix3(h).normalize();var p=l.uvs[n];p.fromArray(e,2*arguments[n])}l.vertexNormalsLength=3,l.material=f.material,C.elements.push(l)}};return{setObject:i,projectVertex:k,checkTriangleVisibility:q,checkBackfaceCulling:s,pushVertex:m,pushNormal:o,pushUv:p,pushLine:t,pushTriangle:v}},Q=new P;this.projectScene=function(j,s,t,v){m=0,o=0,q=0,C.elements.length=0,j.autoUpdate===!0&&j.updateMatrixWorld(),null===s.parent&&s.updateMatrixWorld(),I.copy(s.matrixWorldInverse.getInverse(s.matrixWorld)),J.multiplyMatrices(s.projectionMatrix,I),M.setFromMatrix(J),i=0,C.objects.length=0,C.lights.length=0,j.traverseVisible(function(b){if(b instanceof THREE.Light)C.lights.push(b);else if(b instanceof THREE.Mesh||b instanceof THREE.Line||b instanceof THREE.Sprite){var c=b.material;if(c.visible===!1)return;(b.frustumCulled===!1||M.intersectsObject(b)===!0)&&(h=a(),h.id=b.id,h.object=b,D.setFromMatrixPosition(b.matrixWorld),D.applyProjection(J),h.z=D.z,h.renderOrder=b.renderOrder,C.objects.push(h))}}),t===!0&&C.objects.sort(f);for(var w=0,x=C.objects.length;x>w;w++){var y=C.objects[w].object,z=y.geometry;if(Q.setObject(y),r=y.matrixWorld,k=0,y instanceof THREE.Mesh){if(z instanceof THREE.BufferGeometry){var A=z.attributes,B=z.groups;if(void 0===A.position)continue;for(var F=A.position.array,G=0,H=F.length;H>G;G+=3)Q.pushVertex(F[G],F[G+1],F[G+2]);if(void 0!==A.normal)for(var P=A.normal.array,G=0,H=P.length;H>G;G+=3)Q.pushNormal(P[G],P[G+1],P[G+2]);if(void 0!==A.uv)for(var R=A.uv.array,G=0,H=R.length;H>G;G+=2)Q.pushUv(R[G],R[G+1]);if(null!==z.index){var S=z.index.array;if(B.length>0)for(var w=0;w<B.length;w++)for(var T=B[w],G=T.start,H=T.start+T.count;H>G;G+=3)Q.pushTriangle(S[G],S[G+1],S[G+2]);else for(var G=0,H=S.length;H>G;G+=3)Q.pushTriangle(S[G],S[G+1],S[G+2])}else for(var G=0,H=F.length/3;H>G;G+=3)Q.pushTriangle(G,G+1,G+2)}else if(z instanceof THREE.Geometry){var U=z.vertices,V=z.faces,W=z.faceVertexUvs[0];L.getNormalMatrix(r);for(var X=y.material,Y=X instanceof THREE.MeshFaceMaterial,Z=Y===!0?y.material:null,$=0,_=U.length;_>$;$++){var aa=U[$];if(D.copy(aa),X.morphTargets===!0)for(var ba=z.morphTargets,ca=y.morphTargetInfluences,da=0,ea=ba.length;ea>da;da++){var fa=ca[da];if(0!==fa){var ga=ba[da],ha=ga.vertices[$];D.x+=(ha.x-aa.x)*fa,D.y+=(ha.y-aa.y)*fa,D.z+=(ha.z-aa.z)*fa}}Q.pushVertex(D.x,D.y,D.z)}for(var ia=0,ja=V.length;ja>ia;ia++){var ka=V[ia];if(X=Y===!0?Z.materials[ka.materialIndex]:y.material,void 0!==X){var la=X.side,ma=u[ka.a],na=u[ka.b],oa=u[ka.c];if(Q.checkTriangleVisibility(ma,na,oa)!==!1){var pa=Q.checkBackfaceCulling(ma,na,oa);if(la!==THREE.DoubleSide){if(la===THREE.FrontSide&&pa===!1)continue;if(la===THREE.BackSide&&pa===!0)continue}l=c(),l.id=y.id,l.v1.copy(ma),l.v2.copy(na),l.v3.copy(oa),l.normalModel.copy(ka.normal),pa!==!1||la!==THREE.BackSide&&la!==THREE.DoubleSide||l.normalModel.negate(),l.normalModel.applyMatrix3(L).normalize();for(var qa=ka.vertexNormals,ra=0,sa=Math.min(qa.length,3);sa>ra;ra++){var ta=l.vertexNormalsModel[ra];ta.copy(qa[ra]),pa!==!1||la!==THREE.BackSide&&la!==THREE.DoubleSide||ta.negate(),ta.applyMatrix3(L).normalize()}l.vertexNormalsLength=qa.length;var ua=W[ia];if(void 0!==ua)for(var va=0;3>va;va++)l.uvs[va].copy(ua[va]);l.color=ka.color,l.material=X,l.z=(ma.positionScreen.z+na.positionScreen.z+oa.positionScreen.z)/3,l.renderOrder=y.renderOrder,C.elements.push(l)}}}}}else if(y instanceof THREE.Line){if(z instanceof THREE.BufferGeometry){var A=z.attributes;if(void 0!==A.position){for(var F=A.position.array,G=0,H=F.length;H>G;G+=3)Q.pushVertex(F[G],F[G+1],F[G+2]);if(null!==z.index)for(var S=z.index.array,G=0,H=S.length;H>G;G+=2)Q.pushLine(S[G],S[G+1]);else for(var wa=y instanceof THREE.LineSegments?2:1,G=0,H=F.length/3-1;H>G;G+=wa)Q.pushLine(G,G+1)}}else if(z instanceof THREE.Geometry){K.multiplyMatrices(J,r);var U=y.geometry.vertices;if(0===U.length)continue;ma=b(),ma.positionScreen.copy(U[0]).applyMatrix4(K);for(var wa=y instanceof THREE.LineSegments?2:1,$=1,_=U.length;_>$;$++)ma=b(),ma.positionScreen.copy(U[$]).applyMatrix4(K),($+1)%wa>0||(na=u[k-2],N.copy(ma.positionScreen),O.copy(na.positionScreen),g(N,O)===!0&&(N.multiplyScalar(1/N.w),O.multiplyScalar(1/O.w),n=d(),n.id=y.id,n.v1.positionScreen.copy(N),n.v2.positionScreen.copy(O),n.z=Math.max(N.z,O.z),n.renderOrder=y.renderOrder,n.material=y.material,y.material.vertexColors===THREE.VertexColors&&(n.vertexColors[0].copy(y.geometry.colors[$]),n.vertexColors[1].copy(y.geometry.colors[$-1])),C.elements.push(n)))}}else if(y instanceof THREE.Sprite){E.set(r.elements[12],r.elements[13],r.elements[14],1),E.applyMatrix4(J);var xa=1/E.w;E.z*=xa,E.z>=-1&&E.z<=1&&(p=e(),p.id=y.id,p.x=E.x*xa,p.y=E.y*xa,p.z=E.z,p.renderOrder=y.renderOrder,p.object=y,p.rotation=y.rotation,p.scale.x=y.scale.x*Math.abs(p.x-(E.x+s.projectionMatrix.elements[0])/(E.w+s.projectionMatrix.elements[12])),p.scale.y=y.scale.y*Math.abs(p.y-(E.y+s.projectionMatrix.elements[5])/(E.w+s.projectionMatrix.elements[13])),p.material=y.material,C.elements.push(p))}}return v===!0&&C.elements.sort(f),C}},THREE.BokehShader={uniforms:{textureWidth:{type:"f",value:1},textureHeight:{type:"f",value:1},focalDepth:{type:"f",value:1},focalLength:{type:"f",value:24},fstop:{type:"f",value:.9},tColor:{type:"t",value:null},tDepth:{type:"t",value:null},maxblur:{type:"f",value:1},showFocus:{type:"i",value:0},manualdof:{type:"i",value:0},vignetting:{type:"i",value:0},depthblur:{type:"i",value:0},threshold:{type:"f",value:.5},gain:{type:"f",value:2},bias:{type:"f",value:.5},fringe:{type:"f",value:.7},znear:{type:"f",value:.1},zfar:{type:"f",value:100},noise:{type:"i",value:1},dithering:{type:"f",value:1e-4},pentagon:{type:"i",value:0},shaderFocus:{type:"i",value:1},focusCoords:{type:"v2",value:new THREE.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","const float PI = 3.14159265;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","/*","make sure that these two values are the same for your camera, otherwise distances will be wrong.","*/","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","/*","next part is experimental","not looking good with small sample and ring count","looks okay starting from samples = 4, rings = 4","*/","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","//pentagonal shape","float scale = float(rings) - 1.3;","vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","vec4  one = vec4( 1.0 );","vec4 P = vec4((coords),vec2(scale, scale));","vec4 dist = vec4(0.0);","float inorout = -4.0;","dist.x = dot( P, HS0 );","dist.y = dot( P, HS1 );","dist.z = dot( P, HS2 );","dist.w = dot( P, HS3 );","dist = smoothstep( -feather, feather, dist );","inorout += dot( dist, one );","dist.x = dot( P, HS4 );","dist.y = HS5.w - abs( P.z );","dist = smoothstep( -feather, feather, dist );","inorout += dist.x;","return clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","// Depth buffer blur","float d = 0.0;","float kernel[9];","vec2 offset[9];","vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","offset[0] = vec2(-wh.x,-wh.y);","offset[1] = vec2( 0.0, -wh.y);","offset[2] = vec2( wh.x -wh.y);","offset[3] = vec2(-wh.x,  0.0);","offset[4] = vec2( 0.0,   0.0);","offset[5] = vec2( wh.x,  0.0);","offset[6] = vec2(-wh.x, wh.y);","offset[7] = vec2( 0.0,  wh.y);","offset[8] = vec2( wh.x, wh.y);","kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","for( int i=0; i<9; i++ ) {","float tmp = texture2D(tDepth, coords + offset[i]).r;","d += tmp * kernel[i];","}","return d;","}","vec3 color(vec2 coords,float blur) {","//processing the sample","vec3 col = vec3(0.0);","vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float lum = dot(col.rgb, lumcoeff);","float thresh = max((lum-threshold)*gain, 0.0);","return col+mix(vec3(0.0),col,thresh*blur);","}","vec2 rand(vec2 coord) {","// generating noise / pattern texture for dithering","float noiseX = ((fract(1.0-coord.s*(textureWidth/2.0))*0.25)+(fract(coord.t*(textureHeight/2.0))*0.75))*2.0-1.0;","float noiseY = ((fract(1.0-coord.s*(textureWidth/2.0))*0.75)+(fract(coord.t*(textureHeight/2.0))*0.25))*2.0-1.0;","if (noise) {","noiseX = clamp(fract(sin(dot(coord ,vec2(12.9898,78.233))) * 43758.5453),0.0,1.0)*2.0-1.0;","noiseY = clamp(fract(sin(dot(coord ,vec2(12.9898,78.233)*2.0)) * 43758.5453),0.0,1.0)*2.0-1.0;","}","return vec2(noiseX,noiseY);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","float edge = 0.002*depth; //distance based edge smoothing","float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","return col;","}","float linearize(float depth) {","return -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","float dist = distance(vUv.xy, vec2(0.5,0.5));","dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","return clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","float rings2 = float(rings);","float step = PI*2.0 / float(ringsamples);","float pw = cos(j*step)*i;","float ph = sin(j*step)*i;","float p = 1.0;","if (pentagon) {","p = penta(vec2(pw,ph));","}","col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","return 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","//scene depth calculation","float depth = linearize(texture2D(tDepth,vUv.xy).x);","// Blur depth?","if (depthblur) {","depth = linearize(bdepth(vUv.xy));","}","//focal plane calculation","float fDepth = focalDepth;","if (shaderFocus) {","fDepth = linearize(texture2D(tDepth,focusCoords).x);","}","// dof blur factor calculation","float blur = 0.0;","if (manualdof) {","float a = depth-fDepth; // Focal plane","float b = (a-fdofstart)/fdofdist; // Far DoF","float c = (-a-ndofstart)/ndofdist; // Near Dof","blur = (a>0.0) ? b : c;","} else {","float f = focalLength; // focal length in mm","float d = fDepth*1000.0; // focal plane in mm","float o = depth*1000.0; // depth in mm","float a = (o*f)/(o-f);","float b = (d*f)/(d-f);","float c = (d-f)/(d*fstop*CoC);","blur = abs(a-b)*c;","}","blur = clamp(blur,0.0,1.0);","// calculation of pattern for dithering","vec2 noise = rand(vUv.xy)*dithering*blur;","// getting blur x and y step factor","float w = (1.0/textureWidth)*blur*maxblur+noise.x;","float h = (1.0/textureHeight)*blur*maxblur+noise.y;","// calculation of final color","vec3 col = vec3(0.0);","if(blur < 0.05) {","//some optimization thingy","col = texture2D(tColor, vUv.xy).rgb;","} else {","col = texture2D(tColor, vUv.xy).rgb;","float s = 1.0;","int ringsamples;","for (int i = 1; i <= rings; i++) {","/*unboxstart*/","ringsamples = i * samples;","for (int j = 0 ; j < maxringsamples ; j++) {","if (j >= ringsamples) break;","s += gather(float(i), float(j), ringsamples, col, w, h, blur);","}","/*unboxend*/","}","col /= s; //divide by sample count","}","if (showFocus) {","col = debugFocus(col, blur, depth);","}","if (vignetting) {","col *= vignette();","}","gl_FragColor.rgb = col;","gl_FragColor.a = 1.0;","} "].join("\n")
};for(var circleShape=new THREE.Shape,radius=6,i=0;16>i;i++){var pct=(i+1)/16,theta=pct*Math.PI*2,x=radius*Math.cos(theta),y=radius*Math.sin(theta);0==i?circleShape.moveTo(x,y):circleShape.lineTo(x,y)}var hexagonShape=new THREE.Shape;hexagonShape.moveTo(270,0),hexagonShape.lineTo(0,160),hexagonShape.lineTo(0,485),hexagonShape.lineTo(270,645),hexagonShape.lineTo(560,485),hexagonShape.lineTo(560,160);var starShape=new THREE.Shape;starShape.moveTo(350,75),starShape.lineTo(379,161),starShape.lineTo(469,161),starShape.lineTo(397,215),starShape.lineTo(423,301),starShape.lineTo(350,250),starShape.lineTo(277,301),starShape.lineTo(303,215),starShape.lineTo(231,161),starShape.lineTo(321,161);var PARTICLES=function(){var settings={},gui=null,img=null,cv=null,ctx=null,cvcontainer=null,camera=null,scene=null,windowX=null,windowY=null,windowHalfX=null,windowHalfY=null,mouseX=null,mouseY=null,geometry=null,renderer=null,stats=null,raycaster=null,resetMe=!1,me=null,particle=null,texture=null,extrudeSettings=null,pointLight=null,init=function(){settings={number:500,width:window.innerWidth,height:window.innerHeight,shape:0,rotation:50,vertices:4,maxsize:.2,minsize:.1,spread:0,speed:8e3,zoom:2e3,renderer:0,cameramove:!1,reset:reset,color:"#1861b3",partZoom:2e3,angle:0,lightZ:15300,targetX:-1200,targetY:850},windowX=window.innerWidth,windowY=window.innerHeight,windowHalfX=windowX/2,windowHalfY=windowY/2,cvcontainer=document.createElement("div"),cvcontainer.id="particles",document.body.appendChild(cvcontainer),setRenderer(settings.renderer),renderer.setSize(windowX,windowY),cvcontainer.appendChild(renderer.domElement),scene=new THREE.Scene,geometry=new THREE.PlaneGeometry(5600,4e3,200);var a=new THREE.TextureLoader;a.load("images/night.jpg",function(a){var b=new THREE.MeshBasicMaterial({map:a,side:THREE.FrontSide,overdraw:!1}),c=new THREE.Mesh(geometry,b);scene.add(c)}),camera=new THREE.PerspectiveCamera(100,1,1,2e5),camera.position.set(0,0,settings.zoom),scene.add(camera);var b=new THREE.CubeGeometry(1e4,1e4,1e4),c=new THREE.MeshBasicMaterial({color:0,side:THREE.BackSide}),d=new THREE.Mesh(b,c);scene.add(d),pointLight=new THREE.PointLight(16777215),pointLight.position.set(0,300,settings.lightZ),scene.add(pointLight);var e=1,f=new THREE.PointLightHelper(pointLight,e);scene.add(f),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.addEventListener("touchstart",onDocumentTouchStart,!1),document.addEventListener("touchmove",onDocumentTouchMove,!1),window.addEventListener("resize",onWindowResize,!1),gui=new dat.GUI,gui.add(settings,"angle").listen(),gui.addColor(settings,"color").onChange(reset),gui.add(settings,"speed").min(500).max(3e4).step(500).onFinishChange(function(){reset()}),gui.add(settings,"partZoom").min(0).max(3e4).step(100).onFinishChange(reset),gui.add(settings,"lightZ").min(0).max(3e4).step(100).onFinishChange(reset),gui.add(settings,"zoom").min(0).max(1e4).step(500).onFinishChange(function(){camera.position.set(0,0,settings.zoom),reset()}),gui.add(settings,"number").min(0).max(500).step(1).onFinishChange(reset),gui.add(settings,"spread").min(0).max(4e4).step(1).onFinishChange(reset),gui.add(settings,"width",0).step(1),gui.add(settings,"height",0).step(1),gui.add(settings,"shape",{circle:0,heart:1,hexagon:2}),gui.add(settings,"renderer",{webgl:0,canvas:1,css:2}).onChange(function(){setRenderer(settings.renderer)}),gui.add(settings,"cameramove"),gui.add(settings,"rotation",0,360),gui.add(settings,"targetX").min(-3e3).max(3e3).step(100).onFinishChange(reset),gui.add(settings,"targetY").min(-1e3).max(1e3).step(100).onFinishChange(reset),gui.add(settings,"vertices",2,10).step(1),gui.add(settings,"maxsize").min(.1).max(1).step(.1).onFinishChange(reset),gui.add(settings,"minsize").min(.1).max(1).step(.1).onFinishChange(function(){settings.minsize>settings.maxsize&&this.setValue(settings.maxsize)}),gui.add(settings,"reset"),stats=new Stats,stats.domElement.style.position="absolute",stats.domElement.style.top="0px",cvcontainer.appendChild(stats.domElement),camera.position.x+=.05*(mouseX-camera.position.x),camera.position.y+=.05*(-mouseY-camera.position.y),camera.lookAt(scene.position),createParticles(),animate()},reset=function(){pointLight.position.set(0,300,settings.partZoom),removeParticles(),createParticles(),animate()},setRenderer=function(){switch(settings.renderer){case 0:renderer=new THREE.WebGLRenderer;break;case 1:renderer=new THREE.CanvasRenderer;break;case 2:renderer=new THREE.CSS3DRenderer}},getColor=function(){var colorObj=new THREE.Color(settings.color),hex=colorObj.getHexString(),newcolor="0x"+hex;return eval(newcolor)},createParticles=function(){for(var a=hexagonShape,b=getColor(),c=new THREE.ShapeGeometry(a),d=new THREE.MeshPhongMaterial({color:b,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,opacity:.5,transparent:!0}),e=0;e<settings.number;e++){particle=new THREE.Mesh(c,d),particle.name="part"+e,particle.orbit=365*Math.random;var f=e*Math.random()*200;initParticle(particle,f),scene.add(particle)}},initParticle=function(a,b){var a=this instanceof THREE.Mesh?this:a,b=void 0!==b?b:0,c=Math.random()*windowX+settings.spread-windowHalfX,d=Math.random()*windowY+settings.spread-windowHalfY,e=settings.partZoom;a.position.set(c,d,e),a.scale.x=a.scale.y=Math.random()*settings.maxsize+settings.minsize,new TWEEN.Tween(a.position).delay(b).to({x:100*Math.random()-50+settings.targetX,y:100*Math.random()-50+settings.targetY,z:1},settings.speed).start().onComplete(function(){}),new TWEEN.Tween(a.rotation).delay(b).to({y:Math.random()*settings.rotation,z:Math.random()*settings.rotation},settings.speed).start(),new TWEEN.Tween(a.scale).delay(b).to({x:.05,y:.05},settings.speed).start()},removeParticles=function(){var a=[];console.log("PARTICLES.reset called"),scene.traverse(function(b){b instanceof THREE.Mesh&&"part"==b.name.substring(0,4)&&a.push(b.name)}),resetMe=!0;for(var b=0;b<a.length;b++){var c=scene.getObjectByName(a[b]);scene.remove(c)}render()},update=function(){},onDocumentMouseMove=function(a){mouseX=a.clientX-windowHalfX,mouseY=a.clientY-windowHalfY},onDocumentTouchStart=function(a){1==a.touches.length&&(a.preventDefault(),mouseX=a.touches[0].pageX-windowHalfX,mouseY=a.touches[0].pageY-windowHalfY)},onDocumentTouchMove=function(a){1==a.touches.length&&(a.preventDefault(),mouseX=a.touches[0].pageX-windowHalfX,mouseY=a.touches[0].pageY-windowHalfY)},onWindowResize=function(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)},animate=function(){1==resetMe?resetMe=!1:(requestAnimationFrame(animate),render(),stats.update())},render=function(){settings.angle=(settings.angle+1)%360,TWEEN.update(),settings.cameramove&&(camera.position.x+=.05*(3*mouseX-camera.position.x),camera.position.y+=.05*(3*-mouseY-camera.position.y),camera.lookAt(scene.position)),renderer.render(scene,camera)};return{init:init,camera:camera}}();